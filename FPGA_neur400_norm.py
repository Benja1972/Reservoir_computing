import numpy as np
import pylab as pl
from pydelay import dde23

# define the equations
eqns = { 
        'x' : '(-x-(1/theta)*y+beta*pow(sin(sc*(-0.00000*x(t-0.0025*T)+\
												-0.00000*x(t-0.0050*T)+\
												0.00000*x(t-0.0075*T)+\
												-0.00000*x(t-0.0100*T)+\
												0.00000*x(t-0.0125*T)+\
												-0.00000*x(t-0.0150*T)+\
												0.00000*x(t-0.0175*T)+\
												-0.00000*x(t-0.0200*T)+\
												0.00000*x(t-0.0225*T)+\
												-0.00000*x(t-0.0250*T)+\
												0.00000*x(t-0.0275*T)+\
												0.00000*x(t-0.0300*T)+\
												-0.00000*x(t-0.0325*T)+\
												0.00000*x(t-0.0350*T)+\
												-0.00000*x(t-0.0375*T)+\
												0.00000*x(t-0.0400*T)+\
												-0.00000*x(t-0.0425*T)+\
												0.00000*x(t-0.0450*T)+\
												-0.00000*x(t-0.0475*T)+\
												0.00000*x(t-0.0500*T)+\
												-0.00000*x(t-0.0525*T)+\
												-0.00000*x(t-0.0550*T)+\
												0.00000*x(t-0.0575*T)+\
												-0.00000*x(t-0.0600*T)+\
												0.00000*x(t-0.0625*T)+\
												-0.00000*x(t-0.0650*T)+\
												0.00000*x(t-0.0675*T)+\
												-0.00000*x(t-0.0700*T)+\
												0.00000*x(t-0.0725*T)+\
												-0.00000*x(t-0.0750*T)+\
												0.00000*x(t-0.0775*T)+\
												0.00000*x(t-0.0800*T)+\
												-0.00000*x(t-0.0825*T)+\
												0.00000*x(t-0.0850*T)+\
												-1.00000*x(t-0.0875*T)+\
												1.00000*x(t-0.0900*T)+\
												-1.00000*x(t-0.0925*T)+\
												1.00000*x(t-0.0950*T)+\
												-0.00000*x(t-0.0975*T)+\
												0.00000*x(t-0.1000*T)+\
												-0.00000*x(t-0.1025*T)+\
												-0.00000*x(t-0.1050*T)+\
												0.00000*x(t-0.1075*T)+\
												-1.00000*x(t-0.1100*T)+\
												1.00000*x(t-0.1125*T)+\
												-1.00000*x(t-0.1150*T)+\
												1.00000*x(t-0.1175*T)+\
												-1.00000*x(t-0.1200*T)+\
												1.00000*x(t-0.1225*T)+\
												-0.00000*x(t-0.1250*T)+\
												0.00000*x(t-0.1275*T)+\
												0.00000*x(t-0.1300*T)+\
												-1.00000*x(t-0.1325*T)+\
												1.00000*x(t-0.1350*T)+\
												-1.00000*x(t-0.1375*T)+\
												1.00000*x(t-0.1400*T)+\
												-1.00000*x(t-0.1425*T)+\
												1.00000*x(t-0.1450*T)+\
												-1.00000*x(t-0.1475*T)+\
												0.00000*x(t-0.1500*T)+\
												0.00000*x(t-0.1525*T)+\
												-0.00000*x(t-0.1550*T)+\
												1.00000*x(t-0.1575*T)+\
												-1.00000*x(t-0.1600*T)+\
												1.00000*x(t-0.1625*T)+\
												-1.00000*x(t-0.1650*T)+\
												1.00000*x(t-0.1675*T)+\
												-1.00000*x(t-0.1700*T)+\
												1.00000*x(t-0.1725*T)+\
												-0.00000*x(t-0.1750*T)+\
												0.00000*x(t-0.1775*T)+\
												1.00000*x(t-0.1800*T)+\
												-1.00000*x(t-0.1825*T)+\
												1.00000*x(t-0.1850*T)+\
												-2.00000*x(t-0.1875*T)+\
												2.00000*x(t-0.1900*T)+\
												-2.00000*x(t-0.1925*T)+\
												2.00000*x(t-0.1950*T)+\
												-1.00000*x(t-0.1975*T)+\
												1.00000*x(t-0.2000*T)+\
												-0.00000*x(t-0.2025*T)+\
												-1.00000*x(t-0.2050*T)+\
												1.00000*x(t-0.2075*T)+\
												-2.00000*x(t-0.2100*T)+\
												2.00000*x(t-0.2125*T)+\
												-2.00000*x(t-0.2150*T)+\
												2.00000*x(t-0.2175*T)+\
												-2.00000*x(t-0.2200*T)+\
												2.00000*x(t-0.2225*T)+\
												-1.00000*x(t-0.2250*T)+\
												-0.00000*x(t-0.2275*T)+\
												1.00000*x(t-0.2300*T)+\
												-2.00000*x(t-0.2325*T)+\
												2.00000*x(t-0.2350*T)+\
												-3.00000*x(t-0.2375*T)+\
												3.00000*x(t-0.2400*T)+\
												-3.00000*x(t-0.2425*T)+\
												3.00000*x(t-0.2450*T)+\
												-2.00000*x(t-0.2475*T)+\
												1.00000*x(t-0.2500*T)+\
												-0.00000*x(t-0.2525*T)+\
												-1.00000*x(t-0.2550*T)+\
												2.00000*x(t-0.2575*T)+\
												-3.00000*x(t-0.2600*T)+\
												4.00000*x(t-0.2625*T)+\
												-4.00000*x(t-0.2650*T)+\
												4.00000*x(t-0.2675*T)+\
												-3.00000*x(t-0.2700*T)+\
												2.00000*x(t-0.2725*T)+\
												-1.00000*x(t-0.2750*T)+\
												0.00000*x(t-0.2775*T)+\
												1.00000*x(t-0.2800*T)+\
												-3.00000*x(t-0.2825*T)+\
												4.00000*x(t-0.2850*T)+\
												-5.00000*x(t-0.2875*T)+\
												5.00000*x(t-0.2900*T)+\
												-5.00000*x(t-0.2925*T)+\
												4.00000*x(t-0.2950*T)+\
												-3.00000*x(t-0.2975*T)+\
												2.00000*x(t-0.3000*T)+\
												-0.00000*x(t-0.3025*T)+\
												-2.00000*x(t-0.3050*T)+\
												3.00000*x(t-0.3075*T)+\
												-5.00000*x(t-0.3100*T)+\
												6.00000*x(t-0.3125*T)+\
												-6.00000*x(t-0.3150*T)+\
												6.00000*x(t-0.3175*T)+\
												-5.00000*x(t-0.3200*T)+\
												4.00000*x(t-0.3225*T)+\
												-2.00000*x(t-0.3250*T)+\
												-0.00000*x(t-0.3275*T)+\
												2.00000*x(t-0.3300*T)+\
												-4.00000*x(t-0.3325*T)+\
												6.00000*x(t-0.3350*T)+\
												-7.00000*x(t-0.3375*T)+\
												8.00000*x(t-0.3400*T)+\
												-8.00000*x(t-0.3425*T)+\
												7.00000*x(t-0.3450*T)+\
												-5.00000*x(t-0.3475*T)+\
												3.00000*x(t-0.3500*T)+\
												-0.00000*x(t-0.3525*T)+\
												-3.00000*x(t-0.3550*T)+\
												5.00000*x(t-0.3575*T)+\
												-8.00000*x(t-0.3600*T)+\
												9.00000*x(t-0.3625*T)+\
												-10.00000*x(t-0.3650*T)+\
												10.00000*x(t-0.3675*T)+\
												-8.00000*x(t-0.3700*T)+\
												6.00000*x(t-0.3725*T)+\
												-3.00000*x(t-0.3750*T)+\
												0.00000*x(t-0.3775*T)+\
												4.00000*x(t-0.3800*T)+\
												-7.00000*x(t-0.3825*T)+\
												10.00000*x(t-0.3850*T)+\
												-12.00000*x(t-0.3875*T)+\
												13.00000*x(t-0.3900*T)+\
												-13.00000*x(t-0.3925*T)+\
												11.00000*x(t-0.3950*T)+\
												-8.00000*x(t-0.3975*T)+\
												4.00000*x(t-0.4000*T)+\
												-0.00000*x(t-0.4025*T)+\
												-5.00000*x(t-0.4050*T)+\
												9.00000*x(t-0.4075*T)+\
												-13.00000*x(t-0.4100*T)+\
												16.00000*x(t-0.4125*T)+\
												-17.00000*x(t-0.4150*T)+\
												17.00000*x(t-0.4175*T)+\
												-15.00000*x(t-0.4200*T)+\
												11.00000*x(t-0.4225*T)+\
												-6.00000*x(t-0.4250*T)+\
												0.00000*x(t-0.4275*T)+\
												7.00000*x(t-0.4300*T)+\
												-13.00000*x(t-0.4325*T)+\
												19.00000*x(t-0.4350*T)+\
												-23.00000*x(t-0.4375*T)+\
												25.00000*x(t-0.4400*T)+\
												-25.00000*x(t-0.4425*T)+\
												22.00000*x(t-0.4450*T)+\
												-17.00000*x(t-0.4475*T)+\
												9.00000*x(t-0.4500*T)+\
												-0.00000*x(t-0.4525*T)+\
												-10.00000*x(t-0.4550*T)+\
												21.00000*x(t-0.4575*T)+\
												-31.00000*x(t-0.4600*T)+\
												38.00000*x(t-0.4625*T)+\
												-43.00000*x(t-0.4650*T)+\
												44.00000*x(t-0.4675*T)+\
												-40.00000*x(t-0.4700*T)+\
												32.00000*x(t-0.4725*T)+\
												-18.00000*x(t-0.4750*T)+\
												0.00000*x(t-0.4775*T)+\
												22.00000*x(t-0.4800*T)+\
												-48.00000*x(t-0.4825*T)+\
												75.00000*x(t-0.4850*T)+\
												-103.00000*x(t-0.4875*T)+\
												130.00000*x(t-0.4900*T)+\
												-155.00000*x(t-0.4925*T)+\
												176.00000*x(t-0.4950*T)+\
												-192.00000*x(t-0.4975*T)+\
												201.00000*x(t-0.5000*T)+\
												1843.00000*x(t-0.5025*T)+\
												201.00000*x(t-0.5050*T)+\
												-192.00000*x(t-0.5075*T)+\
												176.00000*x(t-0.5100*T)+\
												-155.00000*x(t-0.5125*T)+\
												130.00000*x(t-0.5150*T)+\
												-103.00000*x(t-0.5175*T)+\
												75.00000*x(t-0.5200*T)+\
												-48.00000*x(t-0.5225*T)+\
												22.00000*x(t-0.5250*T)+\
												0.00000*x(t-0.5275*T)+\
												-18.00000*x(t-0.5300*T)+\
												32.00000*x(t-0.5325*T)+\
												-40.00000*x(t-0.5350*T)+\
												44.00000*x(t-0.5375*T)+\
												-43.00000*x(t-0.5400*T)+\
												38.00000*x(t-0.5425*T)+\
												-31.00000*x(t-0.5450*T)+\
												21.00000*x(t-0.5475*T)+\
												-10.00000*x(t-0.5500*T)+\
												-0.00000*x(t-0.5525*T)+\
												9.00000*x(t-0.5550*T)+\
												-17.00000*x(t-0.5575*T)+\
												22.00000*x(t-0.5600*T)+\
												-25.00000*x(t-0.5625*T)+\
												25.00000*x(t-0.5650*T)+\
												-23.00000*x(t-0.5675*T)+\
												19.00000*x(t-0.5700*T)+\
												-13.00000*x(t-0.5725*T)+\
												7.00000*x(t-0.5750*T)+\
												0.00000*x(t-0.5775*T)+\
												-6.00000*x(t-0.5800*T)+\
												11.00000*x(t-0.5825*T)+\
												-15.00000*x(t-0.5850*T)+\
												17.00000*x(t-0.5875*T)+\
												-17.00000*x(t-0.5900*T)+\
												16.00000*x(t-0.5925*T)+\
												-13.00000*x(t-0.5950*T)+\
												9.00000*x(t-0.5975*T)+\
												-5.00000*x(t-0.6000*T)+\
												-0.00000*x(t-0.6025*T)+\
												4.00000*x(t-0.6050*T)+\
												-8.00000*x(t-0.6075*T)+\
												11.00000*x(t-0.6100*T)+\
												-13.00000*x(t-0.6125*T)+\
												13.00000*x(t-0.6150*T)+\
												-12.00000*x(t-0.6175*T)+\
												10.00000*x(t-0.6200*T)+\
												-7.00000*x(t-0.6225*T)+\
												4.00000*x(t-0.6250*T)+\
												0.00000*x(t-0.6275*T)+\
												-3.00000*x(t-0.6300*T)+\
												6.00000*x(t-0.6325*T)+\
												-8.00000*x(t-0.6350*T)+\
												10.00000*x(t-0.6375*T)+\
												-10.00000*x(t-0.6400*T)+\
												9.00000*x(t-0.6425*T)+\
												-8.00000*x(t-0.6450*T)+\
												5.00000*x(t-0.6475*T)+\
												-3.00000*x(t-0.6500*T)+\
												-0.00000*x(t-0.6525*T)+\
												3.00000*x(t-0.6550*T)+\
												-5.00000*x(t-0.6575*T)+\
												7.00000*x(t-0.6600*T)+\
												-8.00000*x(t-0.6625*T)+\
												8.00000*x(t-0.6650*T)+\
												-7.00000*x(t-0.6675*T)+\
												6.00000*x(t-0.6700*T)+\
												-4.00000*x(t-0.6725*T)+\
												2.00000*x(t-0.6750*T)+\
												-0.00000*x(t-0.6775*T)+\
												-2.00000*x(t-0.6800*T)+\
												4.00000*x(t-0.6825*T)+\
												-5.00000*x(t-0.6850*T)+\
												6.00000*x(t-0.6875*T)+\
												-6.00000*x(t-0.6900*T)+\
												6.00000*x(t-0.6925*T)+\
												-5.00000*x(t-0.6950*T)+\
												3.00000*x(t-0.6975*T)+\
												-2.00000*x(t-0.7000*T)+\
												-0.00000*x(t-0.7025*T)+\
												2.00000*x(t-0.7050*T)+\
												-3.00000*x(t-0.7075*T)+\
												4.00000*x(t-0.7100*T)+\
												-5.00000*x(t-0.7125*T)+\
												5.00000*x(t-0.7150*T)+\
												-5.00000*x(t-0.7175*T)+\
												4.00000*x(t-0.7200*T)+\
												-3.00000*x(t-0.7225*T)+\
												1.00000*x(t-0.7250*T)+\
												0.00000*x(t-0.7275*T)+\
												-1.00000*x(t-0.7300*T)+\
												2.00000*x(t-0.7325*T)+\
												-3.00000*x(t-0.7350*T)+\
												4.00000*x(t-0.7375*T)+\
												-4.00000*x(t-0.7400*T)+\
												4.00000*x(t-0.7425*T)+\
												-3.00000*x(t-0.7450*T)+\
												2.00000*x(t-0.7475*T)+\
												-1.00000*x(t-0.7500*T)+\
												-0.00000*x(t-0.7525*T)+\
												1.00000*x(t-0.7550*T)+\
												-2.00000*x(t-0.7575*T)+\
												3.00000*x(t-0.7600*T)+\
												-3.00000*x(t-0.7625*T)+\
												3.00000*x(t-0.7650*T)+\
												-3.00000*x(t-0.7675*T)+\
												2.00000*x(t-0.7700*T)+\
												-2.00000*x(t-0.7725*T)+\
												1.00000*x(t-0.7750*T)+\
												-0.00000*x(t-0.7775*T)+\
												-1.00000*x(t-0.7800*T)+\
												2.00000*x(t-0.7825*T)+\
												-2.00000*x(t-0.7850*T)+\
												2.00000*x(t-0.7875*T)+\
												-2.00000*x(t-0.7900*T)+\
												2.00000*x(t-0.7925*T)+\
												-2.00000*x(t-0.7950*T)+\
												1.00000*x(t-0.7975*T)+\
												-1.00000*x(t-0.8000*T)+\
												-0.00000*x(t-0.8025*T)+\
												1.00000*x(t-0.8050*T)+\
												-1.00000*x(t-0.8075*T)+\
												2.00000*x(t-0.8100*T)+\
												-2.00000*x(t-0.8125*T)+\
												2.00000*x(t-0.8150*T)+\
												-2.00000*x(t-0.8175*T)+\
												1.00000*x(t-0.8200*T)+\
												-1.00000*x(t-0.8225*T)+\
												1.00000*x(t-0.8250*T)+\
												0.00000*x(t-0.8275*T)+\
												-0.00000*x(t-0.8300*T)+\
												1.00000*x(t-0.8325*T)+\
												-1.00000*x(t-0.8350*T)+\
												1.00000*x(t-0.8375*T)+\
												-1.00000*x(t-0.8400*T)+\
												1.00000*x(t-0.8425*T)+\
												-1.00000*x(t-0.8450*T)+\
												1.00000*x(t-0.8475*T)+\
												-0.00000*x(t-0.8500*T)+\
												0.00000*x(t-0.8525*T)+\
												0.00000*x(t-0.8550*T)+\
												-1.00000*x(t-0.8575*T)+\
												1.00000*x(t-0.8600*T)+\
												-1.00000*x(t-0.8625*T)+\
												1.00000*x(t-0.8650*T)+\
												-1.00000*x(t-0.8675*T)+\
												1.00000*x(t-0.8700*T)+\
												-1.00000*x(t-0.8725*T)+\
												0.00000*x(t-0.8750*T)+\
												0.00000*x(t-0.8775*T)+\
												-0.00000*x(t-0.8800*T)+\
												1.00000*x(t-0.8825*T)+\
												-1.00000*x(t-0.8850*T)+\
												1.00000*x(t-0.8875*T)+\
												-1.00000*x(t-0.8900*T)+\
												1.00000*x(t-0.8925*T)+\
												-1.00000*x(t-0.8950*T)+\
												0.00000*x(t-0.8975*T)+\
												-0.00000*x(t-0.9000*T)+\
												-0.00000*x(t-0.9025*T)+\
												0.00000*x(t-0.9050*T)+\
												-0.00000*x(t-0.9075*T)+\
												1.00000*x(t-0.9100*T)+\
												-1.00000*x(t-0.9125*T)+\
												1.00000*x(t-0.9150*T)+\
												-1.00000*x(t-0.9175*T)+\
												0.00000*x(t-0.9200*T)+\
												-0.00000*x(t-0.9225*T)+\
												0.00000*x(t-0.9250*T)+\
												0.00000*x(t-0.9275*T)+\
												-0.00000*x(t-0.9300*T)+\
												0.00000*x(t-0.9325*T)+\
												-0.00000*x(t-0.9350*T)+\
												0.00000*x(t-0.9375*T)+\
												-0.00000*x(t-0.9400*T)+\
												0.00000*x(t-0.9425*T)+\
												-0.00000*x(t-0.9450*T)+\
												0.00000*x(t-0.9475*T)+\
												-0.00000*x(t-0.9500*T)+\
												-0.00000*x(t-0.9525*T)+\
												0.00000*x(t-0.9550*T)+\
												-0.00000*x(t-0.9575*T)+\
												0.00000*x(t-0.9600*T)+\
												-0.00000*x(t-0.9625*T)+\
												0.00000*x(t-0.9650*T)+\
												-0.00000*x(t-0.9675*T)+\
												0.00000*x(t-0.9700*T)+\
												-0.00000*x(t-0.9725*T)+\
												0.00000*x(t-0.9750*T)+\
												0.00000*x(t-0.9775*T)+\
												-0.00000*x(t-0.9800*T)+\
												0.00000*x(t-0.9825*T)+\
												-0.00000*x(t-0.9850*T)+\
												0.00000*x(t-0.9875*T)+\
												-0.00000*x(t-0.9900*T)+\
												0.00000*x(t-0.9925*T)+\
												-0.00000*x(t-0.9950*T)+\
												0.00000*x(t-0.9975*T)+\
												-0.00000*x(t-1.0000*T))+Phi0),2))',
        'y' : 'x'
        }

#define the parameters, times is in 'ms'
params = {
    'tau'   : 1.0,          # 0.008 ms < tau< 0.10 ms
    'beta'  : .87000,
    'T'     : 0.2*400,          # 1.6 ms < T< 130 ms
    'Phi0'  : 0.25*np.pi,
    'theta' : 603.2,  #603.2,         # 0.8 ms < theta< 1*1000 ms
    'sc'    : 1/2048.03924                 #1/72.3924
    }
print(params)

# Initialise the solver
dde = dde23(eqns=eqns, params=params)

#set the simulation parameters
# (solve from t=0 to t=tfinal and limit the maximum step size to dtmax)
tfinal=5000
tcut=1000
dde.set_sim_params(tfinal=tfinal, dtmax=0.5, AbsTol=10**-3, RelTol=10**-1)

# set the history  using a python lambda function
histfunc = {
    'x': lambda t: -0.0001*np.sin(185.0*t),
    'y': lambda t: -0.0001*np.cos(223.0*t)
    }
dde.hist_from_funcs(histfunc, 1000)


# run the simulator
dde.run()

# Make a plot of x(t) vs x(t-tau):
# Sample the solution twice with a stepsize of dt=0.1:


T=params['T']
beta=params['beta']
tau=params['tau']
theta=params['theta']


sol1 = dde.sample((tfinal-tcut)+T, tfinal,0.1)
x1 = sol1['x']
y1 = sol1['y']
t = sol1['t']

# and once between
sol2 = dde.sample((tfinal-tcut), tfinal-T,0.1)
x2 = sol2['x']


# Figures
plot_params = {'axes.labelsize': 18,
               'text.fontsize': 20,
               'legend.fontsize': 20,
               'title.fontsize': 22,
               'xtick.labelsize': 18,
               'ytick.labelsize': 18}
          
pl.rcParams.update(plot_params)

pl.figure(1)

pl.subplot(211)
pl.plot(t,x1)
pl.xlabel('$t$')
pl.ylabel('$x(t)$')
pl.title(r'$\beta=$ %1.3f,  $\theta=$ %1.2f, $\tau=$ %1.2f, T= %1.2f' 
            % (beta, theta, tau, T ) )

pl.subplot(212)
pl.plot(t,y1)
pl.xlabel('$t$')
pl.ylabel('$y(t)$')


#pl.subplot(313)
#pl.plot(x2, x1,'.')
#pl.xlabel('$x(t-T)$')
#pl.ylabel('$x(t)$')

#pl.figure(2)
#
#H, xedges, yedges = np.histogram2d(x1, x2, bins=100)
#extent = [xedges[0], xedges[-1], yedges[0], yedges[-1]]
#pl.imshow(H, extent=extent)
#pl.xlabel('$x(t)$')
#pl.ylabel('$x(t-T)$')

pl.show()


